const LS_KEY="AutoTheme:mode";let currentMode="light",persistPref=!0,unbind=null;export const Theme={apply(e={}){const t=prefersMoreContrast()?7:4.5,o=isDark()?"dark":"light",r=readStoredMode(),n=e.mode&&"auto"!==e.mode?e.mode:r||o;currentMode=n;const s=e.bg??("dark"===n?"#111218":"#ffffff"),a=e.fg??("dark"===n?"#eaeaf2":"#0e0f13"),c=e.primary??("dark"===n?"#7aa2ff":"#345cff"),i=e.muted??("dark"===n?"#2a2d3a":"#f1f3f7"),d=e.accent??("dark"===n?"#ffb86b":"#b94cff"),l=ensureContrast(a,s,t),u=pickOn(c,t);setVars({"--bg":s,"--fg":toHex(l),"--primary":c,"--on-primary":u,"--muted":i,"--accent":d});const m=document.documentElement;m.setAttribute("data-theme",n),m.style.colorScheme=n,persistPref&&(()=>{try{localStorage.setItem(LS_KEY,n)}catch{}})()},mode(e){return e?("auto"===e?(clearStoredMode(),Theme.apply({mode:"auto"})):(currentMode=e,persistPref&&(()=>{try{localStorage.setItem(LS_KEY,e)}catch{}})(),Theme.apply({mode:e})),currentMode):currentMode},auto(){unwatch();const e=matchMediaSafe("(prefers-color-scheme: dark)"),t=matchMediaSafe("(prefers-contrast: more)"),o=()=>Theme.apply({mode:readStoredMode()?currentMode:"auto"});e?.addEventListener?.("change",o),t?.addEventListener?.("change",o),unbind=(()=>{e?.removeEventListener?.("change",o),t?.removeEventListener?.("change",o),unbind=null}),Theme.apply({mode:"auto"});return{stop:unwatch}},persist:e=>{persistPref=!!e}};function unwatch(){typeof unbind=="function"&&unbind()}function readStoredMode(){try{const e=localStorage.getItem(LS_KEY);return"light"===e||"dark"===e?e:null}catch{return null}}function clearStoredMode(){try{localStorage.removeItem(LS_KEY)}catch{}}function isDark(){return matchMediaSafe("(prefers-color-scheme: dark)")?.matches??!1}function prefersMoreContrast(){return matchMediaSafe("(prefers-contrast: more)")?.matches??!1}function matchMediaSafe(e){try{return window.matchMedia(e)}catch{return null}}function setVars(e){const t=document.documentElement.style;for(const o in e)t.setProperty(o,e[o])}function parseColor(e){if(e=String(e).trim(),"#"===e[0]){const t=e.slice(1);return 3===t.length?{r:parseInt(t[0]+t[0],16),g:parseInt(t[1]+t[1],16),b:parseInt(t[2]+t[2],16)}:{r:parseInt(t.slice(0,2),16),g:parseInt(t.slice(2,4),16),b:parseInt(t.slice(4,6),16)}}if(/^rgb\(/i.test(e)){const t=e.replace(/rgb\(|\)/g,"").split(/\s*,\s*/).map(Number);return{r:t[0],g:t[1],b:t[2]}}if(/^hsl\(/i.test(e)){const t=e.replace(/hsl\(|\)/g,"").split(/\s*,\s*/);return hslToRgb(parseFloat(t[0])/360,parseFloat(t[1])/100,parseFloat(t[2])/100)}throw new Error("unsupported color")}function toHex({r:e,g:t,b:o}){return"#"+h2(e)+h2(t)+h2(o)}function h2(e){return Math.max(0,Math.min(255,0|e)).toString(16).padStart(2,"0")}function rgbToHsl({r:e,g:t,b:o}){e/=255,t/=255,o/=255;const r=Math.max(e,t,o),n=Math.min(e,t,o);let s=0,a=0,c=(r+n)/2;if(r!==n){const i=r-n;a=c>.5?i/(2-r-n):i/(r+n);switch(r){case e:s=(t-o)/i+(t<o?6:0);break;case t:s=(o-e)/i+2;break;default:s=(e-t)/i+4}s/=6}return{h:s,s:a,l:c}}function hslToRgb(e,t,o){e=(e%1+1)%1;const r=(1-Math.abs(2*o-1))*t,n=r*(1-Math.abs(6*e%2-1)),s=o-r/2;let a=0,c=0,i=0;return e<1/6?(a=r,c=n):e<2/6?(a=n,c=r):e<3/6?(c=r,i=n):e<4/6?(c=n,i=r):e<5/6?(a=n,i=r):(a=r,i=n),{r:Math.round(255*(a+s)),g:Math.round(255*(c+s)),b:Math.round(255*(i+s))}}function luminance({r:e,g:t,b:o}){const r=e=>{return e/=255,e<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)};return.2126*r(e)+.7152*r(t)+.0722*r(o)}function contrast(e,t){const o="string"==typeof e?parseColor(e):e,r="string"==typeof t?parseColor(t):t,n=luminance(o),s=luminance(r),a=n>s?[n,s]:[s,n];return(a[0]+.05)/(a[1]+.05)}function pickOn(e,t=4.5){const o="#ffffff",r="#000000",n=contrast(o,e),s=contrast(r,e);return n>=t&&n>=s?o:s>=t&&s>=n?r:n>s?o:r}function ensureContrast(e,t,o=4.5){let r="string"==typeof e?parseColor(e):e;const n="string"==typeof t?parseColor(t):t;if(contrast(r,n)>=o)return r;let s=rgbToHsl(r),a=luminance(n)>.5?.05:.95;for(let c=0;c<40;c++){s.l=s.l+(a-s.l)*.25,r=hslToRgb(s.h,s.s,s.l);if(contrast(r,n)>=o)break}return r}export function a11yContrast(e,t){return contrast(e,t)}export default Theme